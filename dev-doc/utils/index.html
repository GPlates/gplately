<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>gplately.utils API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>gplately.utils</code></h1>
</header>
<section id="section-intro">
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="gplately.utils.crustal_production" href="crustal_production.html">gplately.utils.crustal_production</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="gplately.utils.create_icosahedral_mesh"><code class="name flex">
<span>def <span class="ident">create_icosahedral_mesh</span></span>(<span>refinement_levels)</span>
</code></dt>
<dd>
<div class="desc"><p>Define a global point mesh with Stripy's
<a href="https://github.com/underworldcode/stripy/blob/294354c00dd72e085a018e69c345d9353c6fafef/stripy/spherical_meshes.py#L27">icosahedral triangulated mesh</a>
and turn all mesh domains into pyGPlates MultiPointOnSphere types.</p>
<p>This global mesh will be masked with a set of continental or COB terrane
polygons to define the ocean basin at a given reconstruction time.
The <code>refinement_levels</code> integer is proportional to the resolution of the
mesh and the ocean/continent boundary.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>refinement_levels</code></strong> :&ensp;<code>int</code></dt>
<dd>Refine the number of points in the triangulation. The larger the
refinement level, the sharper the ocean basin resolution.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>multi_point</code></strong> :&ensp;<code>instance</code> of <code>&lt;pygplates.MultiPointOnSphere&gt;</code></dt>
<dd>The longitues and latitudes that make up the icosahedral ocean mesh
collated into a MultiPointOnSphere object.</dd>
<dt><strong><code>icosahedral_global_mesh</code></strong> :&ensp;<code>instance</code> of <code>&lt;stripy.spherical_meshes.icosahedral_mesh&gt;</code></dt>
<dd>The original global icosahedral triangulated mesh.</dd>
</dl></div>
</dd>
<dt id="gplately.utils.ensure_polygon_geometry"><code class="name flex">
<span>def <span class="ident">ensure_polygon_geometry</span></span>(<span>reconstructed_polygons, rotation_model, time)</span>
</code></dt>
<dd>
<div class="desc"><p>Ensure COB terrane/continental polygon geometries are polygons
with reconstruction plate IDs and valid times.</p>
<h2 id="notes">Notes</h2>
<p>This step must be done so that the initial set of ocean basin points
(the Stripy icosahedral mesh) can be partitioned into plates using
each reconstruction plate ID for the given plate <code>model</code>.</p>
<p>This allows for an oceanic point-in-continental
polygon query for every identified plate ID. See documentation for
<code><a title="gplately.utils.point_in_polygon_routine" href="#gplately.utils.point_in_polygon_routine">point_in_polygon_routine()</a></code> for more details.</p>
<p><code><a title="gplately.utils.ensure_polygon_geometry" href="#gplately.utils.ensure_polygon_geometry">ensure_polygon_geometry()</a></code> works as follows:
COB terrane/continental polygons are assumed to have been reconstructed
already in <code>reconstructed_polygons</code> (a list of
type <pygplates.ReconstructedFeatureGeometry>). The list contents are
turned into a <pygplates.FeatureCollection> to be ascribed a
<code>PolygonOnSphere</code> geometry, a reconstruction plate ID, and a valid time.
Once finished, this feature collection is turned back into a list of
instance <pygplates.ReconstructedFeatureGeometry> and returned.</p>
<p>This revert must be completed for compatibility with the subsequent
point-in-polygon routine.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>reconstructed_polygons</code></strong> :&ensp;<code>list</code> of <code>instance &lt;pygplates.ReconstructedFeatureGeometry&gt;</code></dt>
<dd>If used in <code>SeafloorGrid</code>, these are automatically obtained from the
<code>PlotTopologies.continents</code> attribute (the reconstructed continental
polygons at the current reconstruction time).</dd>
<dt><strong><code>rotation_model</code></strong> :&ensp;<code>instance</code> of <code>&lt;pygplates.RotationModel&gt;</code></dt>
<dd>A parameter for turning the <pygplates.FeatureCollection> back into a
list of instance <pygplates.ReconstructedFeatureGeometry> for
compatibility with the point-in-polygon routine.</dd>
</dl></div>
</dd>
<dt id="gplately.utils.plot_subduction_teeth"><code class="name flex">
<span>def <span class="ident">plot_subduction_teeth</span></span>(<span>geometries, width, polarity=None, height=None, spacing=None, projection='auto', transform=None, ax=None, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Add subduction teeth to a plot.</p>
<p>The subduction polarity used for subduction teeth can be specified
manually or detected automatically if <code>geometries</code> is a
<code>geopandas.GeoDataFrame</code> object with a <code>polarity</code> column.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>geometries</code></strong> :&ensp;<code>geopandas.GeoDataFrame, sequence</code> of <code>shapely geometries,</code> or <code>str</code></dt>
<dd>If a <code>geopandas.GeoDataFrame</code> is given, its geometry attribute
will be used. If <code>geometries</code> is a string, it must be the path to
a file, which will be loaded with <code>geopandas.read_file</code>. Otherwise,
<code>geometries</code> must be a sequence of shapely geometry objects (instances
of the <code>shapely.geometry.base.BaseGeometry</code> class).</dd>
<dt><strong><code>width</code></strong> :&ensp;<code>float</code></dt>
<dd>The (approximate) width of the subduction teeth. If a projection is
used, this value will be in projected units.</dd>
<dt><strong><code>polarity</code></strong> :&ensp;<code>{"left", "l", "right", "r", None}</code>, default <code>None</code></dt>
<dd>The subduction polarity of the geometries. If no polarity is provided,
and <code>geometries</code> is a <code>geopandas.GeoDataFrame</code>, this function will
attempt to find a <code>polarity</code> column in the data frame and use the
values given there. If <code>polarity</code> is not manually specified and no
appropriate column can be found, an error will be raised.</dd>
<dt><strong><code>height</code></strong> :&ensp;<code>float</code>, default <code>None</code></dt>
<dd>If provided, the height of the subduction teeth. As with <code>width</code>,
this value should be given in projected units. If no value is given,
the height of the teeth will be equal to 0.6 * <code>width</code>.</dd>
<dt><strong><code>spacing</code></strong> :&ensp;<code>float</code>, default <code>None</code></dt>
<dd>If provided, the spacing between the subduction teeth. As with
<code>width</code> and <code>height</code>, this value should be given in projected units.
If no value is given, <code>spacing</code> will default to <code>width</code>, producing
tightly packed subduction teeth.</dd>
<dt><strong><code>projection</code></strong> :&ensp;<code>cartopy.crs.Transform, "auto",</code> or <code>None</code>, default <code>"auto"</code></dt>
<dd>The projection of the plot. If the plot has no projection, this value
can be explicitly given as <code>None</code>. The default value is "auto", which
will acquire the projection automatically from the plot axes.</dd>
<dt><strong><code>transform</code></strong> :&ensp;<code>cartopy.crs.Transform,</code> or <code>None</code>, default <code>None</code></dt>
<dd>If the plot is projected, a <code>transform</code> value is usually needed.
Frequently, the appropriate value is an instance of
<code>cartopy.crs.PlateCarree</code>.</dd>
<dt><strong><code>ax</code></strong> :&ensp;<code>matplotlib.axes.Axes,</code> or <code>None</code>, default <code>None</code></dt>
<dd>The axes on which the subduction teeth will be drawn. By default,
the current axes will be acquired using <code>matplotlib.pyplot.gca</code>.</dd>
<dt><strong><code>**kwargs</code></strong></dt>
<dd>Any further keyword arguments will be passed to
<code>matplotlib.patches.Polygon</code>.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>ValueError</code></dt>
<dd>If <code>width</code> &lt;= 0, or if <code>polarity</code> is an invalid value or could not
be determined.</dd>
</dl></div>
</dd>
<dt id="gplately.utils.point_in_polygon_routine"><code class="name flex">
<span>def <span class="ident">point_in_polygon_routine</span></span>(<span>multi_point, COB_polygons)</span>
</code></dt>
<dd>
<div class="desc"><p>Perform Plate Tectonic Tools' point in polygon routine to partition
points in a <code>multi_point</code> MultiPointOnSphere feature based on whether
they are inside or outside the polygons in <code>COB_polygons</code>.</p>
<h2 id="notes">Notes</h2>
<p>Assuming the <code>COB_polygons</code> have passed through <code><a title="gplately.utils.ensure_polygon_geometry" href="#gplately.utils.ensure_polygon_geometry">ensure_polygon_geometry()</a></code>,
each polygon should have a plate ID assigned to it.</p>
<p>This PIP routine serves two purposes for <code>SeafloorGrid</code>:</p>
<p>1) It identifies continental regions in the icosahedral global mesh
MultiPointOnSphere feature and 'erases' in-continent oceanic points
for the construction of a continental mask at each timestep;</p>
<p>2) It identifies oceanic points in the icosahedral global mesh.
These points will be passed to a function that calculates each point's
proximity to its nearest MOR segment (if any) within the polygonal domain
of its allocated plate ID. Each distance is divided by half the
<code>initial_ocean_mean_spreading_rate</code> (an attribute of <code>SeafloorGrids</code>) to
determine a simplified seafloor age for each point.</p>
<p>Number 2) only happens once at the start of the gridding process to
momentarily fill the gridding region with initial ocean points that have
set ages (albeit not from a plate model file). After multiple time steps
of reconstruction, the ocean basin will be filled with new points (with
plate-model prescribed ages) that emerge from ridge topologies.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>pygplates.MultiPointOnSphere(points_in_arr) : instance &lt;pygplates.MultiPointOnSphere&gt;</code></dt>
<dd>Point features that are within COB terrane polygons.</dd>
<dt><code>pygplates.MultiPointOnSphere(points_out_arr) : instance &lt;pygplates.MultiPointOnSphere&gt;</code></dt>
<dd>Point features that are outside COB terrane polygons.</dd>
<dt><strong><code>zvals</code></strong> :&ensp;<code>list</code></dt>
<dd>A binary list. If an entry is == 0, its corresponing point in the
MultiPointOnSphere object is on the ocean. If == 1, the point is
in the COB terrane polygon.</dd>
</dl></div>
</dd>
<dt id="gplately.utils.shapelify_features"><code class="name flex">
<span>def <span class="ident">shapelify_features</span></span>(<span>features, central_meridian=0.0, tessellate_degrees=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Generate Shapely <code>MultiPolygon</code> or <code>MultiLineString</code> geometries from reconstructed feature polygons.</p>
<h2 id="notes">Notes</h2>
<p>Some Shapely polygons generated by <code><a title="gplately.utils.shapelify_features" href="#gplately.utils.shapelify_features">shapelify_features()</a></code> cut longitudes of 180
or -180 degrees. These features may appear unclosed at the dateline, so Shapely
"closes" these polygons by connecting any of their open ends with lines. These
lines may manifest on GeoAxes plots as horizontal lines that span the entire
global extent. To prevent this, <code><a title="gplately.utils.shapelify_features" href="#gplately.utils.shapelify_features">shapelify_features()</a></code> uses pyGPlates'
<a href="https://www.gplates.org/docs/pygplates/generated/pygplates.datelinewrapper">DateLineWrapper</a>
to split a feature polygon into multiple closed polygons if it happens to cut the antimeridian.
Another measure taken to ensure features are valid is to order exterior coordinates
of Shapely polygons anti-clockwise.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>features</code></strong> :&ensp;<code>iterable</code> of <code>&lt;pygplates.Feature&gt;, &lt;ReconstructedFeatureGeometry&gt;</code> or <code>&lt;GeometryOnSphere&gt;</code></dt>
<dd>Iterable containing reconstructed polygon features.</dd>
<dt><strong><code>central_meridian</code></strong> :&ensp;<code>float</code></dt>
<dd>Central meridian around which to perform wrapping; default: 0.0.</dd>
<dt><strong><code>tessellate_degrees</code></strong> :&ensp;<code>float</code> or <code>None</code></dt>
<dd>If provided, geometries will be tessellated to this resolution prior to wrapping.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>all_geometries</code></strong> :&ensp;<code>list</code> of <code>shapely.geometry.BaseGeometry</code></dt>
<dd>Shapely geometries converted from the given reconstructed features. Any
geometries at the dateline are split.</dd>
</dl>
<h2 id="see-also">See Also</h2>
<dl>
<dt><code>geometry.pygplates_to_shapely</code></dt>
<dd>convert PyGPlates geometry objects to
<code>Shapely geometries.</code></dd>
</dl></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="GPlately Home" href="https://gplates.github.io/gplately/">
<img src="https://raw.githubusercontent.com/GPlates/gplately/master/Notebooks/NotebookFiles/ReadMe_Files/GPlately_Main_logo.png" alt="GPlately logo" height="172" width="205">
</a>
</header>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="gplately" href="../index.html">gplately</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="gplately.utils.crustal_production" href="crustal_production.html">gplately.utils.crustal_production</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="gplately.utils.create_icosahedral_mesh" href="#gplately.utils.create_icosahedral_mesh">create_icosahedral_mesh</a></code></li>
<li><code><a title="gplately.utils.ensure_polygon_geometry" href="#gplately.utils.ensure_polygon_geometry">ensure_polygon_geometry</a></code></li>
<li><code><a title="gplately.utils.plot_subduction_teeth" href="#gplately.utils.plot_subduction_teeth">plot_subduction_teeth</a></code></li>
<li><code><a title="gplately.utils.point_in_polygon_routine" href="#gplately.utils.point_in_polygon_routine">point_in_polygon_routine</a></code></li>
<li><code><a title="gplately.utils.shapelify_features" href="#gplately.utils.shapelify_features">shapelify_features</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
