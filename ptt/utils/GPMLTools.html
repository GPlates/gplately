<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>gplately.ptt.utils.GPMLTools API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>gplately.ptt.utils.GPMLTools</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Copyright (C) 2014  Michael Tetley
# EarthByte Group, University of Sydney
# Contact email: michael.tetley@sydney.edu.au
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.



#### GPML Tools ####

from __future__ import print_function

import pygplates as pgp
import datetime
import time
import os
import numpy as np


# Filter GPML by selected criteria and output new GPML file of filtered data
def filterGPML(**kwargs):

    # Start the clock
    start = time.time()

    filterProperties = [&#34;inputFile&#34;, &#34;outputFile&#34;, &#34;filterSequence&#34;, &#34;rPlateID&#34;, &#34;cPlateID&#34;, &#34;ageAppearWindow&#34;, &#34;ageDisappearWindow&#34;,
                        &#34;ageExistsWindow&#34;, &#34;boundingBox&#34;, &#34;featureType&#34;, &#34;geometryType&#34;, &#34;featureID&#34;, &#34;featureName&#34;, &#34;feature_truncate_age&#34;, &#34;inverse&#34;, &#34;cascade&#34;]

    # Process supplied arguments and assign values to variables

    # Inverse is set to False by default
    inverse = False

    # Cascade is set to True  by default
    cascade = True

    for parameter, value in kwargs.items():

        if parameter in filterProperties:
            if parameter == filterProperties[0]:
                inputFile = value
            elif parameter == filterProperties[1]:
                outputFile = value
            elif parameter == filterProperties[2]:
                filterSequence = value
            elif parameter == filterProperties[3]:
                rPlateID = value
            elif parameter == filterProperties[4]:
                cPlateID = value
            elif parameter == filterProperties[5]:
                ageAppearWindow = value
            elif parameter == filterProperties[6]:
                ageDisappearWindow = value
            elif parameter == filterProperties[7]:
                ageExistsWindow = value


                if ageExistsWindow[1] &gt; ageExistsWindow[0]:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Age exists window end age older than begin age: &#34; + str(ageExistsWindow[1]))
                    

            elif parameter == filterProperties[8]:
                boundingBox = value

                if pgp.LatLonPoint.is_valid_longitude(boundingBox[0]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box longitude is not valid: &#34; + str(boundingBox[0]))
                    
                if pgp.LatLonPoint.is_valid_longitude(boundingBox[1]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box longitude is not valid: &#34; + str(boundingBox[1]))
                    
                if pgp.LatLonPoint.is_valid_latitude(boundingBox[2]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box latitude is not valid: &#34; + str(boundingBox[2]))
                    
                if pgp.LatLonPoint.is_valid_latitude(boundingBox[3]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box latitude is not valid: &#34; + str(boundingBox[3]))
                    

            elif parameter == filterProperties[9]:
                featureTemp = value
                featureType = []

                if &#34;ALL&#34; in featureTemp:
                    featureType = [&#34;Isochron&#34;, &#34;MidOceanRidge&#34;, &#34;PassiveContinentalBoundary&#34;]
                if &#34;ISO&#34; in featureTemp:
                    featureType.append(&#34;Isochron&#34;)
                if &#34;MOR&#34; in featureTemp:
                    featureType.append(&#34;MidOceanRidge&#34;)
                if &#34;PCB&#34; in featureTemp:
                    featureType.append(&#34;PassiveContinentalBoundary&#34;)

            elif parameter == filterProperties[10]:
                geometryType = value

                if &#34;ALL&#34; in geometryType:
                    geometryType = [&#34;PolylineOnSphere&#34;, &#34;PolygonOnSphere&#34;, &#34;PointOnSphere&#34;, &#34;MultiPointOnSphere&#34;]

            elif parameter == filterProperties[11]:
                featureID = value
            elif parameter == filterProperties[12]:
                featureName = value
            elif parameter == filterProperties[13]:
                feature_truncate_age = value
            elif parameter == filterProperties[14]:
                inverse = value
            elif parameter == filterProperties[15]:
                cascade = value


        else:
            print(&#34; &#34;)
            print(&#34;ERROR - Filter criteria not found: &#34; + str(parameter))
            print(&#34; &#34;)
            


    date = datetime.date.today()

    #if inputFile != &#34;none&#34;:
        #output = pgp.FeatureCollection()

    featureCollection = pgp.FeatureCollectionFileFormatRegistry()

    print(&#34; &#34;)
    print(&#34;--------------------------------------------&#34;)
    print(&#34; ### GPMLTools - filterGPML ###&#34;)

    # Check for existing output directory and create it if not found
    if not os.path.exists(&#34;output&#34;):
        os.makedirs(&#34;output&#34;)
        print(&#34; &#34;)
        print(&#34;Housekeeping:&#34;)
        print(&#34;    No output folder found. Folder &#39;output&#39; created.&#34;)

    # Check for existing output file with same name and remove if found
    if os.path.isfile(&#34;output/output.gpml&#34;):
        os.remove(&#34;output/output.gpml&#34;)
        print(&#34; &#34;)
        print(&#34;Housekeeping:&#34;)
        print(&#34;    Previous &#39;output.gpml&#39; found in destination folder. File removed for new filter sequence.&#34;)


    try:
        feature = featureCollection.read(inputFile)
        feature1 = featureCollection.read(inputFile)
        print(&#34; &#34;)
        print(&#34;Data handling:&#34;)
        print(&#34;    Successfully loaded data file:  &#39;&#34; + str(inputFile) + &#34;&#39;&#34;)
        print(&#34;       - File contains &#34; + str(len(feature)) + &#34; features.&#34;)

    except pgp.OpenFileForReadingError:
        print(&#34; &#34;)
        print(&#34;    ERROR - File read error in: &#39;&#34; + inputFile + &#34;&#39;. Is this a valid GPlates file?&#34;)
        
    except pgp.FileFormatNotSupportedError:
        print(&#34; &#34;)
        print(&#34;    ERROR - File format not supported: &#39;&#34; + inputFile + &#34;&#39;. Please check the file name and try again&#34;)
        



    #Filter data

    print(&#34; &#34;)
    print(&#34;Filter sequence:&#34;)

    previousFilter = 0

    f1_result = pgp.FeatureCollection()
    f2_result = pgp.FeatureCollection()
    f3_result = pgp.FeatureCollection()
    f4_result = pgp.FeatureCollection()
    f5_result = pgp.FeatureCollection()
    f6_result = pgp.FeatureCollection()
    f7_result = pgp.FeatureCollection()
    f8_result = pgp.FeatureCollection()
    f9_result = pgp.FeatureCollection()
    f10_result = pgp.FeatureCollection()
    f11a_result = pgp.FeatureCollection()
    f11b_result = pgp.FeatureCollection()


    for filter_ in filterSequence:

        if previousFilter == 0:
            data_ = feature
        elif previousFilter == 1:
            data_ = f1_result
        elif previousFilter == 2:
            data_ = f2_result
        elif previousFilter == 3:
            data_ = f3_result
        elif previousFilter == 4:
            data_ = f4_result
        elif previousFilter == 5:
            data_ = f5_result
        elif previousFilter == 6:
            data_ = f6_result
        elif previousFilter == 7:
            data_ = f7_result
        elif previousFilter == 8:
            data_ = f8_result
        elif previousFilter == 9:
            data_ = f9_result
        elif previousFilter == 10:
            data_ = f10_result
        elif previousFilter == 11:
            data_ = f11_result



        # Filter by reconstruction plate ID
        if filter_ == 1:

            for feature in data_:

                if cascade == False:

                    for property in feature:

                        filter_property = property.get_name()

                        if filter_property.get_name() == &#34;reconstructionPlateId&#34;:
                            selected_filter_property = property.get_value()

                            for property in feature:

                                filter_property = property.get_name()

                                if filter_property.get_name() == &#34;conjugatePlateId&#34;:
                                    second_filter_property = property.get_value()

                                    if inverse == False:
                         
                                        # Isolate criteria match and process
                                        if str(selected_filter_property) == str(rPlateID[0]) and str(second_filter_property) == str(cPlateID[0]):

                                            # Append filtered data to associated Feature Collection
                                            f1_result.add(feature)

                                    elif inverse == True:

                                        if int(str(selected_filter_property)) not in rPlateID or int(str(second_filter_property)) not in cPlateID:

                                            # Append filtered data to associated Feature Collection
                                            f1_result.add(feature)



                elif cascade == True:

                    for property in feature:

                        filter_property = property.get_name()

                        if filter_property.get_name() == &#34;reconstructionPlateId&#34;:
                            selected_filter_property = property.get_value()

                            if inverse == False:

                                for plateID in rPlateID:

                                    if str(selected_filter_property) == str(plateID):

                                        # Append filtered data to associated Feature Collection
                                        f1_result.add(feature)

                            elif inverse == True:

                                if int(str(selected_filter_property)) not in rPlateID:
                                                                
                                                                # Append filtered data to associated Feature Collection
                                    f1_result.add(feature)

                        

            if cascade == False:
                print(&#34;Oooooh, you found the secret command...&#34;)
                print(&#34; &#34;)
                print(&#34;    1. Filtering data by reconstruction plate ID: &#34; + str(rPlateID) + &#34; and conjugate plate ID: &#34; + str(cPlateID))
                print(&#34;       - Found &#34; + str(len(f1_result)) + &#34; feature(s).&#34;)

                cascade = True

            else:

                print(&#34; &#34;)
                print(&#34;    1. Filtering data by reconstruction plate ID(s): &#34; + str(rPlateID))
                print(&#34;       - Found &#34; + str(len(f1_result)) + &#34; feature(s).&#34;)

            print(&#34; &#34;)

            previousFilter = 1


        # Filter by conjugate plate ID
        if filter_ == 2:

            for feature in data_:
                for property in feature:

                    filter_property = property.get_name()

                    if filter_property.get_name() == &#34;conjugatePlateId&#34;:
                        selected_filter_property = property.get_value()

                        # Isolate criteria match and process
                        if inverse == False:

                            for plateID in cPlateID:

                                if str(selected_filter_property) == str(plateID):

                                    # Append filtered data to associated Feature Collection
                                    f2_result.add(feature)

                        elif inverse == True:

                            if int(str(selected_filter_property)) not in cPlateID:
                                
                                # Append filtered data to associated Feature Collection
                                f2_result.add(feature)

            print(&#34;    2. Filtering data by conjugate plate ID(s): &#34; + str(cPlateID))
            print(&#34;       - Found &#34; + str(len(f2_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 2



        # Filter by age of appearance
        if filter_ == 3:

            if ageAppearWindow[0] == &#34;DP&#34;:
                ageAppearWindow[0] = float(&#34;inf&#34;)

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                if begin_time &lt;= ageAppearWindow[0] and begin_time &gt;= ageAppearWindow[1]:
                    f3_result.add(feature)

            print(&#34;    3. Filtering data by age of appearance window: &#34; + str(ageAppearWindow[0]) + &#34; - &#34; + str(ageAppearWindow[1]) + &#34; Ma&#34;)
            print(&#34;       - Found &#34; + str(len(f3_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 3



        # Filter by age of disappearance
        if filter_ == 4:

            if ageDisappearWindow[1] == &#34;DF&#34;:
                    ageDisappearWindow[1] = float(&#34;-inf&#34;)

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                if end_time &lt;= ageDisappearWindow[0] and end_time &gt;= ageDisappearWindow[1]:
                    f4_result.add(feature)

            print(&#34;    4. Filtering data by age of disappearance window: &#34; + str(ageDisappearWindow[0]) + &#34; - &#34; + str(ageDisappearWindow[1]) + &#34; Ma&#34;)
            print(&#34;       - Found &#34; + str(len(f4_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 4



        # Filter by geographic selection / polygon
        if filter_ == 5:

            for feature in data_:
                for property in feature:

                    filter_property = property.get_name()

                    if filter_property.get_name() == &#34;centerLineOf&#34;:
                        selected_filter_property = property.get_value()

                        points = selected_filter_property.get_value().get_base_curve().get_polyline().get_points_view()

                        for point in points:
                            point_latlong = pgp.convert_point_on_sphere_to_lat_lon_point(point)

                            if point_latlong.get_longitude() &gt;= float(boundingBox[0]) and point_latlong.get_longitude() &lt;= float(boundingBox[1])\
                                    and point_latlong.get_latitude() &gt;= float(boundingBox[2]) and point_latlong.get_latitude() &lt;= float(boundingBox[3]):

                                # If point is found within bounding box, add feature and break loop (search next feature)
                                f5_result.add(feature)
                                break

            print(&#34;    5. Filtering data by geographic bounding box: &#34; + str(boundingBox[0]) + &#34;/&#34; + str(boundingBox[1]) + &#34;/&#34; + str(boundingBox[2]) + &#34;/&#34; + str(boundingBox[3]))
            print(&#34;       - Found &#34; + str(len(f5_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 5



        # Filter by age exists window
        if filter_ == 6:

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                if begin_time &gt;= ageExistsWindow[0] and end_time &lt;= ageExistsWindow[1]:
                    f6_result.add(feature)
                elif begin_time &gt;= ageExistsWindow[0] and end_time &lt;= ageExistsWindow[0] and end_time &gt;= ageExistsWindow[1]:
                    f6_result.add(feature)
                elif begin_time &lt;= ageExistsWindow[0] and end_time &gt;= ageExistsWindow[1]:
                    f6_result.add(feature)
                elif begin_time &lt;= ageExistsWindow[0] and end_time &gt;= ageExistsWindow[1] and end_time &lt;= ageExistsWindow[1]:
                    f6_result.add(feature)

            print(&#34;    6. Filtering data by age of existence window: &#34; + str(ageExistsWindow[0]) + &#34; - &#34; + str(ageExistsWindow[1]) + &#34; Ma&#34;)
            print(&#34;       - Found &#34; + str(len(f6_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 6



        # Filter by feature type
        if filter_ == 7:

            iso_count = 0
            mor_count = 0
            pcb_count = 0

            for feature in data_:

                if &#34;Isochron&#34; in featureType:
                    if str(feature.get_feature_type()) == &#34;gpml:Isochron&#34;:
                        f7_result.add(feature)
                        iso_count += 1
                if &#34;MidOceanRidge&#34; in featureType:
                    if str(feature.get_feature_type()) == &#34;gpml:MidOceanRidge&#34;:
                        f7_result.add(feature)
                        mor_count += 1
                if &#34;PassiveContinentalBoundary&#34; in featureType:
                    if str(feature.get_feature_type()) == &#34;gpml:PassiveContinentalBoundary&#34;:
                        f7_result.add(feature)
                        pcb_count += 1


            print(&#34;    7. Filtering data by feature type(s): &#34; + str(featureType))

            if &#34;Isochron&#34; in featureType:
                print(&#34;       - Found &#34; + str(iso_count) + &#34; Isochron(s).&#34;)
            if &#34;MidOceanRidge&#34; in featureType:
                print(&#34;       - Found &#34; + str(mor_count) + &#34; MidOceanRidge(s).&#34;)
            if &#34;PassiveContinentalBoundary&#34; in featureType:
                print(&#34;       - Found &#34; + str(pcb_count) + &#34; PassiveContinentalBoundary(s).&#34;)

            print(&#34; &#34;)

            previousFilter = 7



        # Filter by geometry type
        if filter_ == 8:

            polylineCount = 0
            polygonCount = 0
            pointCount = 0
            multiPointCount = 0

            for feature in data_:

                geometries = feature.get_geometry()

                for geometry in geometryType:

                    if str(geometry) in str(geometries):
                        f8_result.add(feature)

                        if str(geometry) == &#34;PolylineOnSphere&#34;:
                            polylineCount += 1
                        if str(geometry) == &#34;PolygonOnSphere&#34;:
                            polygonCount += 1
                        if str(geometry) == &#34;PointOnSphere&#34;:
                            pointCount += 1
                        if str(geometry) == &#34;MultiPointOnSphere&#34;:
                            multiPointCount += 1

            print(&#34;    8. Filtering data by feature geometries present: &#34; + str(geometryType))

            if &#34;PolylineOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(polylineCount) + &#34; PolylineOnSphere(s).&#34;)
            if &#34;PolygonOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(polygonCount) + &#34; PolygonOnSphere(s).&#34;)
            if &#34;PointOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(pointCount) + &#34; PointOnSphere(s).&#34;)
            if &#34;MultiPointOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(multiPointCount) + &#34; MultiPointOnSphere(s).&#34;)

            print(&#34; &#34;)

            previousFilter = 8



        # Filter by feature ID
        if filter_ == 9:

            for feature in data_:

                for id in featureID:
                    if str(feature.get_feature_id()).lower() == str(id).lower():
                        f9_result.add(feature)

            print(&#34;    9. Filtering data by feature ID: &#34; + str(featureID))
            print(&#34;       - Found &#34; + str(len(f9_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 9



        # Filter by feature name (case insensitive)
        if filter_ == 10:

            for feature in data_:

                feature_name = feature.get_name()

                for names in featureName:

                    if names.lower() in feature_name.lower():
                        f10_result.add(feature)

            print(&#34;    10. Filtering data by feature name: &#34; + str(featureName))
            print(&#34;       - Found &#34; + str(len(f10_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 10



        # Truncate file by age boundary
        if filter_ == 11:

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                
                if begin_time &gt; feature_truncate_age and end_time &gt; feature_truncate_age:

                    f11a_result.add(feature)


                elif begin_time &gt; feature_truncate_age and end_time &lt;= feature_truncate_age:

                    # Special case if SubductionZone - need to incorporate start age
                    if str(feature.get_feature_type()) == &#34;gpml:SubductionZone&#34;:

                        feature.set_valid_time(begin_time, feature_truncate_age + 0.1)
                        f11a_result.add(feature)
                        
                    else:

                        feature.set_valid_time(begin_time, feature_truncate_age + 0.1)
                        f11a_result.add(feature)


            # Limitation of pyGPlates: need to loop through copy of feature
            for feature in feature1:

                begin_time, end_time = feature.get_valid_time()

        
                if begin_time &gt; feature_truncate_age and end_time &lt;= feature_truncate_age:

                    # Special case if SubductionZone - need to incorporate start age
                    if str(feature.get_feature_type()) == &#34;gpml:SubductionZone&#34;:

                        #print(feature.get_name())
                        sz_age_array = []

                        for property in feature:

                            # Create array or properties and add &#39;gpml:subductionZoneAge&#39; if there isn&#39;t one already
                            sz_age_array.append(str(property.get_name()))

                        
                        if &#34;gpml:subductionZoneAge&#34; not in sz_age_array:
                                
                            #print(feature.get_name())
                            feature.add(pgp.PropertyName.create_gpml(&#39;subductionZoneAge&#39;), pgp.XsDouble(begin_time))


                        feature.set_valid_time(feature_truncate_age, end_time)

                        f11b_result.add(feature)


                    else:

                        feature.set_valid_time(feature_truncate_age, end_time)
                        f11b_result.add(feature)


                elif begin_time == feature_truncate_age:

                    f11b_result.add(feature)


                elif begin_time &lt;= feature_truncate_age and end_time &lt; feature_truncate_age:

                    f11b_result.add(feature)

                
            print(&#34;    11. File truncated by age boundary: &#34; + str(feature_truncate_age) + &#34; Ma&#34;)
            print(&#34;       - Created &#34; + str(len(f11a_result)) + &#34; feature(s) older than truncation boundary.&#34;)
            print(&#34;       - Created &#34; + str(len(f11b_result)) + &#34; feature(s) younger than truncation boundary.&#34;)
            print(&#34; &#34;)

            previousFilter = 11




    # output new feature collection from filtered data to file

    if previousFilter == 11:

        iso_output1 = eval(&#34;f&#34; + str(previousFilter) + &#34;a_result&#34;)
        iso_output2 = eval(&#34;f&#34; + str(previousFilter) + &#34;b_result&#34;)

        if len(iso_output1) != 0:
            
            outputFeatureCollection1 = pgp.FeatureCollectionFileFormatRegistry()
            outputFeatureCollection1.write(iso_output1, &#34;output/&gt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34; + str(outputFile))

            print(&#34; &#34;)
            print(&#34;Output file 1:&#34;)
            print(&#34;    ../output/&#34; + &#34;&gt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34;+ str(outputFile))
            print(&#34; &#34;)
            print(&#34;Process took &#34; + str(round(time.time() - start, 2)) + &#34; seconds.&#34;)
            print(&#34; &#34;)

        if len(iso_output2) != 0:
            
            outputFeatureCollection2 = pgp.FeatureCollectionFileFormatRegistry()
            outputFeatureCollection2.write(iso_output2, &#34;output/&lt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34; + str(outputFile))

            print(&#34;Output file 2:&#34;)
            print(&#34;    ../output/&#34; + &#34;&lt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34;+ str(outputFile))
            print(&#34; &#34;)
            print(&#34;Process took &#34; + str(round(time.time() - start, 2)) + &#34; seconds.&#34;)
            print(&#34;--------------------------------------------&#34;)


    else:

        iso_output = eval(&#34;f&#34; + str(previousFilter) + &#34;_result&#34;)

        outputFeatureCollection = pgp.FeatureCollectionFileFormatRegistry()
        outputFeatureCollection.write(iso_output, outputFile)

        print(&#34;Output file:&#34;)
        print(str(outputFile))
        print(&#34; &#34;)
        print(&#34;Process took &#34; + str(round(time.time() - start, 2)) + &#34; seconds.&#34;)
        print(&#34;--------------------------------------------&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="gplately.ptt.utils.GPMLTools.filterGPML"><code class="name flex">
<span>def <span class="ident">filterGPML</span></span>(<span>**kwargs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def filterGPML(**kwargs):

    # Start the clock
    start = time.time()

    filterProperties = [&#34;inputFile&#34;, &#34;outputFile&#34;, &#34;filterSequence&#34;, &#34;rPlateID&#34;, &#34;cPlateID&#34;, &#34;ageAppearWindow&#34;, &#34;ageDisappearWindow&#34;,
                        &#34;ageExistsWindow&#34;, &#34;boundingBox&#34;, &#34;featureType&#34;, &#34;geometryType&#34;, &#34;featureID&#34;, &#34;featureName&#34;, &#34;feature_truncate_age&#34;, &#34;inverse&#34;, &#34;cascade&#34;]

    # Process supplied arguments and assign values to variables

    # Inverse is set to False by default
    inverse = False

    # Cascade is set to True  by default
    cascade = True

    for parameter, value in kwargs.items():

        if parameter in filterProperties:
            if parameter == filterProperties[0]:
                inputFile = value
            elif parameter == filterProperties[1]:
                outputFile = value
            elif parameter == filterProperties[2]:
                filterSequence = value
            elif parameter == filterProperties[3]:
                rPlateID = value
            elif parameter == filterProperties[4]:
                cPlateID = value
            elif parameter == filterProperties[5]:
                ageAppearWindow = value
            elif parameter == filterProperties[6]:
                ageDisappearWindow = value
            elif parameter == filterProperties[7]:
                ageExistsWindow = value


                if ageExistsWindow[1] &gt; ageExistsWindow[0]:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Age exists window end age older than begin age: &#34; + str(ageExistsWindow[1]))
                    

            elif parameter == filterProperties[8]:
                boundingBox = value

                if pgp.LatLonPoint.is_valid_longitude(boundingBox[0]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box longitude is not valid: &#34; + str(boundingBox[0]))
                    
                if pgp.LatLonPoint.is_valid_longitude(boundingBox[1]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box longitude is not valid: &#34; + str(boundingBox[1]))
                    
                if pgp.LatLonPoint.is_valid_latitude(boundingBox[2]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box latitude is not valid: &#34; + str(boundingBox[2]))
                    
                if pgp.LatLonPoint.is_valid_latitude(boundingBox[3]) is False:
                    print(&#34; &#34;)
                    print(&#34;ERROR - Bounding box latitude is not valid: &#34; + str(boundingBox[3]))
                    

            elif parameter == filterProperties[9]:
                featureTemp = value
                featureType = []

                if &#34;ALL&#34; in featureTemp:
                    featureType = [&#34;Isochron&#34;, &#34;MidOceanRidge&#34;, &#34;PassiveContinentalBoundary&#34;]
                if &#34;ISO&#34; in featureTemp:
                    featureType.append(&#34;Isochron&#34;)
                if &#34;MOR&#34; in featureTemp:
                    featureType.append(&#34;MidOceanRidge&#34;)
                if &#34;PCB&#34; in featureTemp:
                    featureType.append(&#34;PassiveContinentalBoundary&#34;)

            elif parameter == filterProperties[10]:
                geometryType = value

                if &#34;ALL&#34; in geometryType:
                    geometryType = [&#34;PolylineOnSphere&#34;, &#34;PolygonOnSphere&#34;, &#34;PointOnSphere&#34;, &#34;MultiPointOnSphere&#34;]

            elif parameter == filterProperties[11]:
                featureID = value
            elif parameter == filterProperties[12]:
                featureName = value
            elif parameter == filterProperties[13]:
                feature_truncate_age = value
            elif parameter == filterProperties[14]:
                inverse = value
            elif parameter == filterProperties[15]:
                cascade = value


        else:
            print(&#34; &#34;)
            print(&#34;ERROR - Filter criteria not found: &#34; + str(parameter))
            print(&#34; &#34;)
            


    date = datetime.date.today()

    #if inputFile != &#34;none&#34;:
        #output = pgp.FeatureCollection()

    featureCollection = pgp.FeatureCollectionFileFormatRegistry()

    print(&#34; &#34;)
    print(&#34;--------------------------------------------&#34;)
    print(&#34; ### GPMLTools - filterGPML ###&#34;)

    # Check for existing output directory and create it if not found
    if not os.path.exists(&#34;output&#34;):
        os.makedirs(&#34;output&#34;)
        print(&#34; &#34;)
        print(&#34;Housekeeping:&#34;)
        print(&#34;    No output folder found. Folder &#39;output&#39; created.&#34;)

    # Check for existing output file with same name and remove if found
    if os.path.isfile(&#34;output/output.gpml&#34;):
        os.remove(&#34;output/output.gpml&#34;)
        print(&#34; &#34;)
        print(&#34;Housekeeping:&#34;)
        print(&#34;    Previous &#39;output.gpml&#39; found in destination folder. File removed for new filter sequence.&#34;)


    try:
        feature = featureCollection.read(inputFile)
        feature1 = featureCollection.read(inputFile)
        print(&#34; &#34;)
        print(&#34;Data handling:&#34;)
        print(&#34;    Successfully loaded data file:  &#39;&#34; + str(inputFile) + &#34;&#39;&#34;)
        print(&#34;       - File contains &#34; + str(len(feature)) + &#34; features.&#34;)

    except pgp.OpenFileForReadingError:
        print(&#34; &#34;)
        print(&#34;    ERROR - File read error in: &#39;&#34; + inputFile + &#34;&#39;. Is this a valid GPlates file?&#34;)
        
    except pgp.FileFormatNotSupportedError:
        print(&#34; &#34;)
        print(&#34;    ERROR - File format not supported: &#39;&#34; + inputFile + &#34;&#39;. Please check the file name and try again&#34;)
        



    #Filter data

    print(&#34; &#34;)
    print(&#34;Filter sequence:&#34;)

    previousFilter = 0

    f1_result = pgp.FeatureCollection()
    f2_result = pgp.FeatureCollection()
    f3_result = pgp.FeatureCollection()
    f4_result = pgp.FeatureCollection()
    f5_result = pgp.FeatureCollection()
    f6_result = pgp.FeatureCollection()
    f7_result = pgp.FeatureCollection()
    f8_result = pgp.FeatureCollection()
    f9_result = pgp.FeatureCollection()
    f10_result = pgp.FeatureCollection()
    f11a_result = pgp.FeatureCollection()
    f11b_result = pgp.FeatureCollection()


    for filter_ in filterSequence:

        if previousFilter == 0:
            data_ = feature
        elif previousFilter == 1:
            data_ = f1_result
        elif previousFilter == 2:
            data_ = f2_result
        elif previousFilter == 3:
            data_ = f3_result
        elif previousFilter == 4:
            data_ = f4_result
        elif previousFilter == 5:
            data_ = f5_result
        elif previousFilter == 6:
            data_ = f6_result
        elif previousFilter == 7:
            data_ = f7_result
        elif previousFilter == 8:
            data_ = f8_result
        elif previousFilter == 9:
            data_ = f9_result
        elif previousFilter == 10:
            data_ = f10_result
        elif previousFilter == 11:
            data_ = f11_result



        # Filter by reconstruction plate ID
        if filter_ == 1:

            for feature in data_:

                if cascade == False:

                    for property in feature:

                        filter_property = property.get_name()

                        if filter_property.get_name() == &#34;reconstructionPlateId&#34;:
                            selected_filter_property = property.get_value()

                            for property in feature:

                                filter_property = property.get_name()

                                if filter_property.get_name() == &#34;conjugatePlateId&#34;:
                                    second_filter_property = property.get_value()

                                    if inverse == False:
                         
                                        # Isolate criteria match and process
                                        if str(selected_filter_property) == str(rPlateID[0]) and str(second_filter_property) == str(cPlateID[0]):

                                            # Append filtered data to associated Feature Collection
                                            f1_result.add(feature)

                                    elif inverse == True:

                                        if int(str(selected_filter_property)) not in rPlateID or int(str(second_filter_property)) not in cPlateID:

                                            # Append filtered data to associated Feature Collection
                                            f1_result.add(feature)



                elif cascade == True:

                    for property in feature:

                        filter_property = property.get_name()

                        if filter_property.get_name() == &#34;reconstructionPlateId&#34;:
                            selected_filter_property = property.get_value()

                            if inverse == False:

                                for plateID in rPlateID:

                                    if str(selected_filter_property) == str(plateID):

                                        # Append filtered data to associated Feature Collection
                                        f1_result.add(feature)

                            elif inverse == True:

                                if int(str(selected_filter_property)) not in rPlateID:
                                                                
                                                                # Append filtered data to associated Feature Collection
                                    f1_result.add(feature)

                        

            if cascade == False:
                print(&#34;Oooooh, you found the secret command...&#34;)
                print(&#34; &#34;)
                print(&#34;    1. Filtering data by reconstruction plate ID: &#34; + str(rPlateID) + &#34; and conjugate plate ID: &#34; + str(cPlateID))
                print(&#34;       - Found &#34; + str(len(f1_result)) + &#34; feature(s).&#34;)

                cascade = True

            else:

                print(&#34; &#34;)
                print(&#34;    1. Filtering data by reconstruction plate ID(s): &#34; + str(rPlateID))
                print(&#34;       - Found &#34; + str(len(f1_result)) + &#34; feature(s).&#34;)

            print(&#34; &#34;)

            previousFilter = 1


        # Filter by conjugate plate ID
        if filter_ == 2:

            for feature in data_:
                for property in feature:

                    filter_property = property.get_name()

                    if filter_property.get_name() == &#34;conjugatePlateId&#34;:
                        selected_filter_property = property.get_value()

                        # Isolate criteria match and process
                        if inverse == False:

                            for plateID in cPlateID:

                                if str(selected_filter_property) == str(plateID):

                                    # Append filtered data to associated Feature Collection
                                    f2_result.add(feature)

                        elif inverse == True:

                            if int(str(selected_filter_property)) not in cPlateID:
                                
                                # Append filtered data to associated Feature Collection
                                f2_result.add(feature)

            print(&#34;    2. Filtering data by conjugate plate ID(s): &#34; + str(cPlateID))
            print(&#34;       - Found &#34; + str(len(f2_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 2



        # Filter by age of appearance
        if filter_ == 3:

            if ageAppearWindow[0] == &#34;DP&#34;:
                ageAppearWindow[0] = float(&#34;inf&#34;)

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                if begin_time &lt;= ageAppearWindow[0] and begin_time &gt;= ageAppearWindow[1]:
                    f3_result.add(feature)

            print(&#34;    3. Filtering data by age of appearance window: &#34; + str(ageAppearWindow[0]) + &#34; - &#34; + str(ageAppearWindow[1]) + &#34; Ma&#34;)
            print(&#34;       - Found &#34; + str(len(f3_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 3



        # Filter by age of disappearance
        if filter_ == 4:

            if ageDisappearWindow[1] == &#34;DF&#34;:
                    ageDisappearWindow[1] = float(&#34;-inf&#34;)

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                if end_time &lt;= ageDisappearWindow[0] and end_time &gt;= ageDisappearWindow[1]:
                    f4_result.add(feature)

            print(&#34;    4. Filtering data by age of disappearance window: &#34; + str(ageDisappearWindow[0]) + &#34; - &#34; + str(ageDisappearWindow[1]) + &#34; Ma&#34;)
            print(&#34;       - Found &#34; + str(len(f4_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 4



        # Filter by geographic selection / polygon
        if filter_ == 5:

            for feature in data_:
                for property in feature:

                    filter_property = property.get_name()

                    if filter_property.get_name() == &#34;centerLineOf&#34;:
                        selected_filter_property = property.get_value()

                        points = selected_filter_property.get_value().get_base_curve().get_polyline().get_points_view()

                        for point in points:
                            point_latlong = pgp.convert_point_on_sphere_to_lat_lon_point(point)

                            if point_latlong.get_longitude() &gt;= float(boundingBox[0]) and point_latlong.get_longitude() &lt;= float(boundingBox[1])\
                                    and point_latlong.get_latitude() &gt;= float(boundingBox[2]) and point_latlong.get_latitude() &lt;= float(boundingBox[3]):

                                # If point is found within bounding box, add feature and break loop (search next feature)
                                f5_result.add(feature)
                                break

            print(&#34;    5. Filtering data by geographic bounding box: &#34; + str(boundingBox[0]) + &#34;/&#34; + str(boundingBox[1]) + &#34;/&#34; + str(boundingBox[2]) + &#34;/&#34; + str(boundingBox[3]))
            print(&#34;       - Found &#34; + str(len(f5_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 5



        # Filter by age exists window
        if filter_ == 6:

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                if begin_time &gt;= ageExistsWindow[0] and end_time &lt;= ageExistsWindow[1]:
                    f6_result.add(feature)
                elif begin_time &gt;= ageExistsWindow[0] and end_time &lt;= ageExistsWindow[0] and end_time &gt;= ageExistsWindow[1]:
                    f6_result.add(feature)
                elif begin_time &lt;= ageExistsWindow[0] and end_time &gt;= ageExistsWindow[1]:
                    f6_result.add(feature)
                elif begin_time &lt;= ageExistsWindow[0] and end_time &gt;= ageExistsWindow[1] and end_time &lt;= ageExistsWindow[1]:
                    f6_result.add(feature)

            print(&#34;    6. Filtering data by age of existence window: &#34; + str(ageExistsWindow[0]) + &#34; - &#34; + str(ageExistsWindow[1]) + &#34; Ma&#34;)
            print(&#34;       - Found &#34; + str(len(f6_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 6



        # Filter by feature type
        if filter_ == 7:

            iso_count = 0
            mor_count = 0
            pcb_count = 0

            for feature in data_:

                if &#34;Isochron&#34; in featureType:
                    if str(feature.get_feature_type()) == &#34;gpml:Isochron&#34;:
                        f7_result.add(feature)
                        iso_count += 1
                if &#34;MidOceanRidge&#34; in featureType:
                    if str(feature.get_feature_type()) == &#34;gpml:MidOceanRidge&#34;:
                        f7_result.add(feature)
                        mor_count += 1
                if &#34;PassiveContinentalBoundary&#34; in featureType:
                    if str(feature.get_feature_type()) == &#34;gpml:PassiveContinentalBoundary&#34;:
                        f7_result.add(feature)
                        pcb_count += 1


            print(&#34;    7. Filtering data by feature type(s): &#34; + str(featureType))

            if &#34;Isochron&#34; in featureType:
                print(&#34;       - Found &#34; + str(iso_count) + &#34; Isochron(s).&#34;)
            if &#34;MidOceanRidge&#34; in featureType:
                print(&#34;       - Found &#34; + str(mor_count) + &#34; MidOceanRidge(s).&#34;)
            if &#34;PassiveContinentalBoundary&#34; in featureType:
                print(&#34;       - Found &#34; + str(pcb_count) + &#34; PassiveContinentalBoundary(s).&#34;)

            print(&#34; &#34;)

            previousFilter = 7



        # Filter by geometry type
        if filter_ == 8:

            polylineCount = 0
            polygonCount = 0
            pointCount = 0
            multiPointCount = 0

            for feature in data_:

                geometries = feature.get_geometry()

                for geometry in geometryType:

                    if str(geometry) in str(geometries):
                        f8_result.add(feature)

                        if str(geometry) == &#34;PolylineOnSphere&#34;:
                            polylineCount += 1
                        if str(geometry) == &#34;PolygonOnSphere&#34;:
                            polygonCount += 1
                        if str(geometry) == &#34;PointOnSphere&#34;:
                            pointCount += 1
                        if str(geometry) == &#34;MultiPointOnSphere&#34;:
                            multiPointCount += 1

            print(&#34;    8. Filtering data by feature geometries present: &#34; + str(geometryType))

            if &#34;PolylineOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(polylineCount) + &#34; PolylineOnSphere(s).&#34;)
            if &#34;PolygonOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(polygonCount) + &#34; PolygonOnSphere(s).&#34;)
            if &#34;PointOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(pointCount) + &#34; PointOnSphere(s).&#34;)
            if &#34;MultiPointOnSphere&#34; in geometryType:
                print(&#34;       - Found &#34; + str(multiPointCount) + &#34; MultiPointOnSphere(s).&#34;)

            print(&#34; &#34;)

            previousFilter = 8



        # Filter by feature ID
        if filter_ == 9:

            for feature in data_:

                for id in featureID:
                    if str(feature.get_feature_id()).lower() == str(id).lower():
                        f9_result.add(feature)

            print(&#34;    9. Filtering data by feature ID: &#34; + str(featureID))
            print(&#34;       - Found &#34; + str(len(f9_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 9



        # Filter by feature name (case insensitive)
        if filter_ == 10:

            for feature in data_:

                feature_name = feature.get_name()

                for names in featureName:

                    if names.lower() in feature_name.lower():
                        f10_result.add(feature)

            print(&#34;    10. Filtering data by feature name: &#34; + str(featureName))
            print(&#34;       - Found &#34; + str(len(f10_result)) + &#34; feature(s).&#34;)
            print(&#34; &#34;)

            previousFilter = 10



        # Truncate file by age boundary
        if filter_ == 11:

            for feature in data_:

                begin_time, end_time = feature.get_valid_time()

                
                if begin_time &gt; feature_truncate_age and end_time &gt; feature_truncate_age:

                    f11a_result.add(feature)


                elif begin_time &gt; feature_truncate_age and end_time &lt;= feature_truncate_age:

                    # Special case if SubductionZone - need to incorporate start age
                    if str(feature.get_feature_type()) == &#34;gpml:SubductionZone&#34;:

                        feature.set_valid_time(begin_time, feature_truncate_age + 0.1)
                        f11a_result.add(feature)
                        
                    else:

                        feature.set_valid_time(begin_time, feature_truncate_age + 0.1)
                        f11a_result.add(feature)


            # Limitation of pyGPlates: need to loop through copy of feature
            for feature in feature1:

                begin_time, end_time = feature.get_valid_time()

        
                if begin_time &gt; feature_truncate_age and end_time &lt;= feature_truncate_age:

                    # Special case if SubductionZone - need to incorporate start age
                    if str(feature.get_feature_type()) == &#34;gpml:SubductionZone&#34;:

                        #print(feature.get_name())
                        sz_age_array = []

                        for property in feature:

                            # Create array or properties and add &#39;gpml:subductionZoneAge&#39; if there isn&#39;t one already
                            sz_age_array.append(str(property.get_name()))

                        
                        if &#34;gpml:subductionZoneAge&#34; not in sz_age_array:
                                
                            #print(feature.get_name())
                            feature.add(pgp.PropertyName.create_gpml(&#39;subductionZoneAge&#39;), pgp.XsDouble(begin_time))


                        feature.set_valid_time(feature_truncate_age, end_time)

                        f11b_result.add(feature)


                    else:

                        feature.set_valid_time(feature_truncate_age, end_time)
                        f11b_result.add(feature)


                elif begin_time == feature_truncate_age:

                    f11b_result.add(feature)


                elif begin_time &lt;= feature_truncate_age and end_time &lt; feature_truncate_age:

                    f11b_result.add(feature)

                
            print(&#34;    11. File truncated by age boundary: &#34; + str(feature_truncate_age) + &#34; Ma&#34;)
            print(&#34;       - Created &#34; + str(len(f11a_result)) + &#34; feature(s) older than truncation boundary.&#34;)
            print(&#34;       - Created &#34; + str(len(f11b_result)) + &#34; feature(s) younger than truncation boundary.&#34;)
            print(&#34; &#34;)

            previousFilter = 11




    # output new feature collection from filtered data to file

    if previousFilter == 11:

        iso_output1 = eval(&#34;f&#34; + str(previousFilter) + &#34;a_result&#34;)
        iso_output2 = eval(&#34;f&#34; + str(previousFilter) + &#34;b_result&#34;)

        if len(iso_output1) != 0:
            
            outputFeatureCollection1 = pgp.FeatureCollectionFileFormatRegistry()
            outputFeatureCollection1.write(iso_output1, &#34;output/&gt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34; + str(outputFile))

            print(&#34; &#34;)
            print(&#34;Output file 1:&#34;)
            print(&#34;    ../output/&#34; + &#34;&gt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34;+ str(outputFile))
            print(&#34; &#34;)
            print(&#34;Process took &#34; + str(round(time.time() - start, 2)) + &#34; seconds.&#34;)
            print(&#34; &#34;)

        if len(iso_output2) != 0:
            
            outputFeatureCollection2 = pgp.FeatureCollectionFileFormatRegistry()
            outputFeatureCollection2.write(iso_output2, &#34;output/&lt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34; + str(outputFile))

            print(&#34;Output file 2:&#34;)
            print(&#34;    ../output/&#34; + &#34;&lt;&#34; + str(feature_truncate_age) + &#34;Ma_&#34;+ str(outputFile))
            print(&#34; &#34;)
            print(&#34;Process took &#34; + str(round(time.time() - start, 2)) + &#34; seconds.&#34;)
            print(&#34;--------------------------------------------&#34;)


    else:

        iso_output = eval(&#34;f&#34; + str(previousFilter) + &#34;_result&#34;)

        outputFeatureCollection = pgp.FeatureCollectionFileFormatRegistry()
        outputFeatureCollection.write(iso_output, outputFile)

        print(&#34;Output file:&#34;)
        print(str(outputFile))
        print(&#34; &#34;)
        print(&#34;Process took &#34; + str(round(time.time() - start, 2)) + &#34; seconds.&#34;)
        print(&#34;--------------------------------------------&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="GPlately Home" href="https://gplates.github.io/gplately/">
<img src="https://raw.githubusercontent.com/GPlates/gplately/master/Notebooks/NotebookFiles/ReadMe_Files/GPlately_Main_logo.png" alt="GPlately logo" height="172" width="205">
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="gplately.ptt.utils" href="index.html">gplately.ptt.utils</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="gplately.ptt.utils.GPMLTools.filterGPML" href="#gplately.ptt.utils.GPMLTools.filterGPML">filterGPML</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>