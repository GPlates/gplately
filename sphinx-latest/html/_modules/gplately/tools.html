

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>gplately.tools &mdash; gplately 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=51b770b3"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            gplately
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../basic_usages.html">Minimal working example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../use_cases.html">Common Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Trouble-shooting and FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line_interface.html">Command Line Interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../primer.html">Primer</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">GPlately API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">gplately</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">gplately.tools</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for gplately.tools</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1">#    Copyright (C) 2024 The University of Sydney, Australia</span>
<span class="c1">#</span>
<span class="c1">#    This program is free software; you can redistribute it and/or modify it under</span>
<span class="c1">#    the terms of the GNU General Public License, version 2, as published by</span>
<span class="c1">#    the Free Software Foundation.</span>
<span class="c1">#</span>
<span class="c1">#    This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="c1">#    ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="c1">#    FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
<span class="c1">#    for more details.</span>
<span class="c1">#</span>
<span class="c1">#    You should have received a copy of the GNU General Public License along</span>
<span class="c1">#    with this program; if not, write to Free Software Foundation, Inc.,</span>
<span class="c1">#    51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;A module that offers tools for executing common geological calculations, mathematical conversions and numpy conversions.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pygplates</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.spatial</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">haversine_distance</span><span class="p">,</span>
    <span class="n">geocentric_radius</span><span class="p">,</span>
    <span class="n">lonlat2xyz</span><span class="p">,</span>
    <span class="n">xyz2lonlat</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">EARTH_RADIUS</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">mean_radius_in_kms</span>

<span class="n">_DEFAULT_PLATE_THICKNESS</span> <span class="o">=</span> <span class="mf">125.0e3</span>
<span class="n">_DEFAULT_T_MANTLE</span> <span class="o">=</span> <span class="mf">1350.0</span>
<span class="n">_DEFAULT_KAPPA</span> <span class="o">=</span> <span class="mf">8.04e-7</span>
<span class="n">_SEC_PER_MYR</span> <span class="o">=</span> <span class="mf">3.15576e13</span>


<div class="viewcode-block" id="plate_temp">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.plate_temp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plate_temp</span><span class="p">(</span>
    <span class="n">age</span><span class="p">,</span>
    <span class="n">z</span><span class="p">,</span>
    <span class="n">plate_thickness</span><span class="o">=</span><span class="n">_DEFAULT_PLATE_THICKNESS</span><span class="p">,</span>
    <span class="n">kappa</span><span class="o">=</span><span class="n">_DEFAULT_KAPPA</span><span class="p">,</span>
    <span class="n">t_mantle</span><span class="o">=</span><span class="n">_DEFAULT_T_MANTLE</span><span class="p">,</span>
    <span class="n">t_surface</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the temperature in a cooling plate for a given age, plate</span>
<span class="sd">    thickness, and depth.</span>

<span class="sd">    By default, assumes a mantle temperature of 1350 degrees, and a 0 degree</span>
<span class="sd">    surface temperature. Kappa defaults to 0.804e-6.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    age : float</span>
<span class="sd">        The geological time (Ma) at which to calculate plate temperature.</span>
<span class="sd">    z : array_like</span>
<span class="sd">        The plate depth(s) (m) at which to calculate temperature.</span>
<span class="sd">    plate_thickness : float, default: 125.0e3</span>
<span class="sd">        The thickness (m) of the plate in consideration.</span>
<span class="sd">    kappa : float, default: 0.804e-6</span>
<span class="sd">    t_mantle : float, default: 1350.0</span>
<span class="sd">        Mantle temperature at the Moho, in degrees Celsius.</span>
<span class="sd">    t_surface : float, default: 0.0</span>
<span class="sd">        Temperature at the surface, in degrees Celsius.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The plate temperature at the given age and depth. This is a scalar</span>
<span class="sd">        if `z` is a scalar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aged</span> <span class="o">=</span> <span class="n">age</span> <span class="o">*</span> <span class="n">_SEC_PER_MYR</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">sine_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="n">plate_thickness</span>
    <span class="n">exp_arg</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">aged</span> <span class="o">/</span> <span class="p">(</span><span class="n">plate_thickness</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cumsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">sine_arg</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp_arg</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">t_surface</span>
        <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">cumsum</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_mantle</span> <span class="o">-</span> <span class="n">t_surface</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">t_mantle</span> <span class="o">-</span> <span class="n">t_surface</span><span class="p">)</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="n">plate_thickness</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># input was a scalar</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span></div>



<div class="viewcode-block" id="plate_isotherm_depth">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.plate_isotherm_depth">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plate_isotherm_depth</span><span class="p">(</span>
    <span class="n">age</span><span class="p">,</span>
    <span class="n">temp</span><span class="o">=</span><span class="mf">1150.0</span><span class="p">,</span>
    <span class="n">plate_thickness</span><span class="o">=</span><span class="n">_DEFAULT_PLATE_THICKNESS</span><span class="p">,</span>
    <span class="n">maxiter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">require_convergence</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the depth to the temp - isotherm in a cooling plate mode. Solution by iteration.</span>

<span class="sd">    By default the plate thickness is 125 km as in Parsons/Sclater.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    age : array_like</span>
<span class="sd">        Geological ages (Ma) at which to compute depths.</span>
<span class="sd">    temp : float, default: 1150.0</span>
<span class="sd">        The temperature of a temp-isotherm for which to calculate depth,</span>
<span class="sd">        in degrees Celsius.</span>
<span class="sd">    plate_thickness : float, default: 125.0e3</span>
<span class="sd">        Thickness of the plate, in metres.</span>
<span class="sd">    maxiter : int, default: 50</span>
<span class="sd">        Maximum number of iterations.</span>
<span class="sd">    tol: float, default: 0.001</span>
<span class="sd">        Tolerance for convergence of `plate_temp`.</span>
<span class="sd">    require_convergence: bool, default: False</span>
<span class="sd">        If True, raise a `RuntimeError` if convergence is not reached within</span>
<span class="sd">        `maxiter` iterations; if False, a `RuntimeWarning` is issued instead.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Any further keyword arguments are passed on to `plate_temp`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    z : ndarray</span>
<span class="sd">        Array of depths to the chosen temperature isotherm at the given ages.</span>
<span class="sd">        This is a scalar if `age` is a scalar.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        If `require_convergence` is True and convergence is not reached within</span>
<span class="sd">        `maxiter` iterations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If `rtol` is passed, use that as `tol`</span>
    <span class="c1"># `rtol` actually means &#39;relative tolerance&#39; in scipy,</span>
    <span class="c1"># while `xtol` is used for absolute tolerance</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rtol&quot;</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

    <span class="c1"># For backwards compatibility, also allow `n` as a keyword argument</span>
    <span class="n">maxiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">)</span>

    <span class="n">maxiter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxiter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">maxiter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`maxiter` must be greater than zero (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxiter</span><span class="p">))</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>

    <span class="n">non_zero_ages</span> <span class="o">=</span> <span class="n">age</span><span class="p">[</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="n">zi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">non_zero_ages</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>  <span class="c1"># starting depth is 0</span>

    <span class="n">z_too_small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">non_zero_ages</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">z_too_big</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">non_zero_ages</span><span class="p">,</span> <span class="n">plate_thickness</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">t_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">non_zero_ages</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxiter</span><span class="p">):</span>
        <span class="n">zi</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">z_too_small</span> <span class="o">+</span> <span class="n">z_too_big</span><span class="p">)</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">plate_temp</span><span class="p">(</span><span class="n">non_zero_ages</span><span class="p">,</span> <span class="n">zi</span><span class="p">,</span> <span class="n">plate_thickness</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">t_diff</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="n">ti</span>
        <span class="n">z_too_big</span><span class="p">[</span><span class="n">t_diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tol</span><span class="p">]</span> <span class="o">=</span> <span class="n">zi</span><span class="p">[</span><span class="n">t_diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">tol</span><span class="p">]</span>
        <span class="n">z_too_small</span><span class="p">[</span><span class="n">t_diff</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span> <span class="o">=</span> <span class="n">zi</span><span class="p">[</span><span class="n">t_diff</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">break</span>

    <span class="c1"># convergence warning</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">failed_ages</span> <span class="o">=</span> <span class="n">non_zero_ages</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Solution did not converge below tol=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; within maxiter=</span><span class="si">{}</span><span class="s2"> iterations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxiter</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; for the following ages: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">failed_ages</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">require_convergence</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>

    <span class="c1"># protect against negative ages</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
    <span class="n">out</span><span class="p">[</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">zi</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">age</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># input age was a scalar</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="plate_surface_depth">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.plate_surface_depth">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plate_surface_depth</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;Richards2020&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the depth to the surface of a cooling plate.</span>

<span class="sd">    Essentially converts the ocean basin age to basement depth using a specified age/depth model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    age : float</span>
<span class="sd">        The age in Ma.</span>
<span class="sd">    model : str</span>
<span class="sd">        The model to use when converting ocean age to basement depth.</span>
<span class="sd">        - &#39;Richards2020&#39;: Richards et al. (2020), Structure and dynamics of the oceanic lithosphere-asthenosphere system</span>
<span class="sd">        - &#39;Stein1992&#39;: Stein and Stein (1992), Model for the global variation in oceanic depth and heat flow with lithospheric age</span>
<span class="sd">        - &#39;Parsons1977&#39;: Parsons and Sclater (1972), An analysis of the variation of ocean floor bathymetry and heat flow with age</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    depth : array</span>
<span class="sd">        Depth (in metres) as a positive number.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `model` is not a recognised model.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Richards2020 curve is approximate. A polynomial was fitted to the age-depth data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;Richards2020&quot;</span><span class="p">:</span>
        <span class="n">opt_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4.40989118e01</span><span class="p">,</span> <span class="mf">1.16071448e05</span><span class="p">,</span> <span class="mf">1.02003657e-06</span><span class="p">,</span> <span class="mf">2.47658681e03</span><span class="p">]</span>
        <span class="n">temp</span><span class="p">,</span> <span class="n">plate_thickness</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">opt_params</span>

        <span class="n">depth</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">plate_isotherm_depth</span><span class="p">(</span>
                <span class="n">age</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">plate_thickness</span><span class="o">=</span><span class="n">plate_thickness</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="n">offset</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;Stein1992&quot;</span><span class="p">:</span>
        <span class="n">mask_age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">20</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">5651.0</span> <span class="o">-</span> <span class="mf">2473.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0278</span> <span class="o">*</span> <span class="n">age</span><span class="p">))</span>
        <span class="n">depth</span><span class="p">[</span><span class="n">mask_age</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2600.0</span> <span class="o">+</span> <span class="mf">365.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">mask_age</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;Parsons1977&quot;</span><span class="p">:</span>
        <span class="n">mask_age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">70</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">6400.0</span> <span class="o">-</span> <span class="mf">3200.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">age</span> <span class="o">/</span> <span class="mf">62.8</span><span class="p">))</span>
        <span class="n">depth</span><span class="p">[</span><span class="n">mask_age</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2500.0</span> <span class="o">+</span> <span class="mi">350</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">age</span><span class="p">[</span><span class="n">mask_age</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;model should be one of Richards2020 or Stein1992&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">depth</span></div>



<div class="viewcode-block" id="points_to_features">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.points_to_features">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">points_to_features</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">plate_ID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">return_points</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates point features represented on a unit length sphere in 3D cartesian coordinates from a latitude and</span>
<span class="sd">    longitude list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lons : int or list</span>
<span class="sd">        The longitudes of needed point features.</span>

<span class="sd">    lats : int or list</span>
<span class="sd">        The latitudes of needed point features.</span>

<span class="sd">    plate_ID : int or list, default=None</span>
<span class="sd">        The reconstruction plate ID(s) to assign to the needed point features.</span>

<span class="sd">    return_points : bool, default=False</span>
<span class="sd">        Whether to also return the points (converted from latitude/longitude to `pygplates.PointOnSphere`).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    point_features : pygplates.Feature, or list of pygplates.Feature</span>
<span class="sd">        Point features (of type `pygplates.Feature`) created from the given lists of lat-lon point coordinates.</span>
<span class="sd">    points : pygplates.PointOnSphere, or list of pygplates.PointOnSphere</span>
<span class="sd">        Points (of type `pygplates.PointOnSphere`) created from the given lists of lat-lon point coordinates.</span>
<span class="sd">        Points are only returned if `return_points` is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">lons</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">lats</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;lons&#39; and &#39;lats&#39; must be of equal length&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">{}</span><span class="s2"> != </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;lons&#39; and &#39;lats&#39; must be provided&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">plate_ID</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">plate_ID</span> <span class="o">=</span> <span class="p">[</span><span class="n">plate_ID</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plate_ID</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;plate_ID&#39; must be same length as &#39;lons&#39; and &#39;lats&#39;&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; (</span><span class="si">{}</span><span class="s2"> != </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plate_ID</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="c1"># create point features</span>
    <span class="n">point_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">return_points</span><span class="p">:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">pid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">plate_ID</span><span class="p">):</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">PointOnSphere</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">return_points</span><span class="p">:</span>
            <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

        <span class="n">point_feature</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">Feature</span><span class="p">()</span>
        <span class="n">point_feature</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point_feature</span><span class="o">.</span><span class="n">set_reconstruction_plate_id</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">point_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_feature</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">return_points</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">point_features</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">point_features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">return_points</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">point_features</span><span class="p">,</span> <span class="n">points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">point_features</span></div>



<div class="viewcode-block" id="extract_feature_lonlat">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.extract_feature_lonlat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_feature_lonlat</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the latitudes and longitudes of topological feature points.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    features : list</span>
<span class="sd">        A list of topological point features to extract lat-lon coordinates from.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rlon, rlat : lists</span>
<span class="sd">        Extracted longitudes and latitudes of feature points. Each index corresponds to different points. Same length</span>
<span class="sd">        as the input feature array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>
    <span class="n">rlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">feature</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">get_reconstructed_geometry</span><span class="p">()</span>
        <span class="n">rlat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rlon</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">to_lat_lon</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">rlon</span><span class="p">,</span> <span class="n">rlat</span></div>



<div class="viewcode-block" id="plate_partitioner_for_point">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.plate_partitioner_for_point">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plate_partitioner_for_point</span><span class="p">(</span><span class="n">lat_lon_tuple</span><span class="p">,</span> <span class="n">topology_features</span><span class="p">,</span> <span class="n">rotation_model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the present-day plate ID of a (lat, lon) coordinate pair if</span>
<span class="sd">    it is not specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotation_model</span><span class="p">,</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">RotationModel</span><span class="p">):</span>
        <span class="n">rotation_model</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">RotationModel</span><span class="p">(</span><span class="n">rotation_model</span><span class="p">)</span>
    <span class="n">plate_partitioner</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">PlatePartitioner</span><span class="p">(</span>
        <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="n">topology_features</span><span class="p">),</span>
        <span class="n">rotation_model</span><span class="p">,</span>
        <span class="n">reconstruction_time</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">partitioning_plate</span> <span class="o">=</span> <span class="n">plate_partitioner</span><span class="o">.</span><span class="n">partition_point</span><span class="p">(</span>
        <span class="n">pygplates</span><span class="o">.</span><span class="n">PointOnSphere</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_lon_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat_lon_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="p">)</span>
    <span class="n">plate_id_at_present_day</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">partitioning_plate</span><span class="o">.</span><span class="n">get_feature</span><span class="p">()</span><span class="o">.</span><span class="n">get_reconstruction_plate_id</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">plate_id_at_present_day</span></div>



<div class="viewcode-block" id="read_rotation_file_pandas">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.read_rotation_file_pandas">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_rotation_file_pandas</span><span class="p">(</span><span class="n">rotation_file_paths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Written by Nicky M Wright. Extract data from one rotation file, and write</span>
<span class="sd">    it to a pandas dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rotation_file</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">rotation_file_paths</span><span class="p">,</span>
        <span class="n">names</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;reconstruction_plate_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;age&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lon&quot;</span><span class="p">,</span>
            <span class="s2">&quot;angle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;anchor_plate_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comment&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;!&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rotation_file_paths</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">comment</span> <span class="o">=</span> <span class="s2">&quot;!&quot;</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">head</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>

    <span class="n">rotation_file</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>

    <span class="k">return</span> <span class="n">rotation_file</span></div>



<div class="viewcode-block" id="correct_longitudes_for_dateline">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.correct_longitudes_for_dateline">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">correct_longitudes_for_dateline</span><span class="p">(</span><span class="n">lons</span><span class="p">):</span>
    <span class="n">lons</span><span class="p">[</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">360</span>  <span class="c1"># correct for dateline</span>
    <span class="k">return</span> <span class="n">lons</span></div>



<span class="c1"># Auxiliary functions for the Muller et al. 2022 paper &quot;Evolution of Earth’s tectonic carbon conveyor belt&quot;</span>
<div class="viewcode-block" id="surface_area_oblate_spheroid">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.surface_area_oblate_spheroid">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">surface_area_oblate_spheroid</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">r1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r1</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>



<div class="viewcode-block" id="geocentric_area">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.geocentric_area">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">geocentric_area</span><span class="p">(</span><span class="n">latitude_one</span><span class="p">,</span> <span class="n">latitude_two</span><span class="p">,</span> <span class="n">longitude_resolution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the point area of an evenly gridded lat/lon mesh</span>
<span class="sd">    Longitude resolution is lon2 - lon1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude_two</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude_one</span><span class="p">))</span>
    <span class="n">lat_area</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">6371.009e3</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dlat</span><span class="p">)</span> <span class="o">/</span> <span class="n">longitude_resolution</span>
    <span class="k">return</span> <span class="n">lat_area</span></div>



<span class="n">lat_area_function</span> <span class="o">=</span> <span class="n">geocentric_area</span>


<div class="viewcode-block" id="smooth_1D">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.smooth_1D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">smooth_1D</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gaussian filter with standard deviation&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>



<div class="viewcode-block" id="My2s">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.My2s">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">My2s</span><span class="p">(</span><span class="n">my</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;convert million year(my) to seconds. Roughly, 1 Million Years =  31,536,000,000,000 Seconds&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">my</span> <span class="o">*</span> <span class="mf">3.1536e13</span></div>



<div class="viewcode-block" id="update_progress">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.update_progress">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">update_progress</span><span class="p">(</span><span class="n">progress</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">clear_output</span>

    <span class="n">bar_length</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">progress</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">progress</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">progress</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">bar_length</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">block</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">bar_length</span> <span class="o">*</span> <span class="n">progress</span><span class="p">))</span>

    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Progress: [</span><span class="si">{0}</span><span class="s2">] </span><span class="si">{1:.1f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="n">block</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">bar_length</span> <span class="o">-</span> <span class="n">block</span><span class="p">),</span> <span class="n">progress</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>



<div class="viewcode-block" id="read_csv">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.read_csv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">readcols</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;read csv and reorder from 0 - 250 Ma&quot;&quot;&quot;</span>
    <span class="n">Ma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">readcols</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">Ma</span><span class="p">]</span></div>



<div class="viewcode-block" id="smooth_1D_gaussian">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.smooth_1D_gaussian">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">smooth_1D_gaussian</span><span class="p">(</span>
    <span class="n">input_data</span><span class="p">,</span> <span class="n">time_window</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;reflect&quot;</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mf">4.0</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Smooth every data element in the 1D `input_data` array over a</span>
<span class="sd">    specified `time_window`, using a one-dimensional, zeroth order</span>
<span class="sd">    Gaussian filter.</span>

<span class="sd">    The `time_window`, or Gaussian kernel diameter, is used to</span>
<span class="sd">    calculate a sigma for the Gaussian kernel.</span>

<span class="sd">    For example, if a `time_window` of 20 Myr is supplied, an array with 21</span>
<span class="sd">    elements (10 Myr on each side of a central point, including the central</span>
<span class="sd">    point) is produced. Each element is filled with the Gaussian evaluated</span>
<span class="sd">    at that point.</span>

<span class="sd">    This Gaussian is correlated to each data point in the input_array to</span>
<span class="sd">    smooth the data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_data : 1d array</span>
<span class="sd">        A one-dimensional array of input data to smooth using a Gaussian filter.</span>
<span class="sd">    time_window : float, default = 5 (Myr)</span>
<span class="sd">        A float or integer to specify the full width of the Gaussian filter with</span>
<span class="sd">        which to smooth each data point in `input_data`. 1 pixel : 1 Myr.</span>
<span class="sd">    axis : int, default = -1</span>
<span class="sd">        The axis of `input_data` along which to smooth. Default is -1.</span>
<span class="sd">    output : array or dtype, optional</span>
<span class="sd">        The array in which to place the output, or the dtype of the returned array.</span>
<span class="sd">        By default an array of the same dtype as input will be created.</span>
<span class="sd">    mode : str, default &quot;reflect&quot;</span>
<span class="sd">        The way the input_array is extended beyond its bounds to ensure all data</span>
<span class="sd">        points can be convolved with the created Gaussian. See</span>
<span class="sd">        [scipy&#39;s docs](https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.gaussian_filter1d.html)</span>
<span class="sd">        to see the full list of extension methods. By default, `&quot;reflect&quot;` extends</span>
<span class="sd">        `input_array` such that [a b c d] becomes (d c b a | a b c d | d c b a),</span>
<span class="sd">        reflecting about the edge of the last pixel.</span>
<span class="sd">    truncate : float or int, default = 4.0</span>
<span class="sd">        A multiplicative factor that truncates the number of standard deviations, or</span>
<span class="sd">        sigmas, that the Gaussian distribution spans in either direction from the</span>
<span class="sd">        centre. This impacts the number of pixels that the Gaussian kernel spans.</span>
<span class="sd">        By default, this is set to 4 standard deviations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sigma, the magnitude of standard deviation in pixel units, is truncated</span>
    <span class="c1"># by a specified number of permissible standard deviations; 4 by default</span>
    <span class="c1"># half the time window defines the width of the gaussian kernel</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">time_window</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">radius</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">truncate</span><span class="p">)</span>

    <span class="c1"># Produce the gaussian kernel given a sigma and kernel full-width/diameter</span>
    <span class="c1"># (time_window). The coefficient 1/sqrt(2*pi)*sigma is omitted as it</span>
    <span class="c1"># just scales the kernel distribution and does not impact smoothing weights</span>
    <span class="n">time_window_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">time_window_array</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Ensure sum of kernel is normalised to unity</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span> <span class="o">/</span> <span class="n">kernel</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Correlate the input data to the Gaussian kernel</span>
    <span class="n">smoothed_data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">correlate1d</span><span class="p">(</span>
        <span class="n">input_data</span><span class="p">,</span>
        <span class="n">kernel</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">,</span>
        <span class="n">output</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># 0 centers the filter over the pixel</span>
        <span class="n">cval</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># Only applicable if mode is &#39;constant&#39;, extends filter by 0s everywhere.</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">smoothed_data</span></div>



<div class="viewcode-block" id="griddata_sphere">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.griddata_sphere">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">griddata_sphere</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolate unstructured D-D data on the sphere.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points : 2-D ndarray of floats with shape (n, D), or length D tuple of 1-D ndarrays with shape (n,).</span>
<span class="sd">        Data point coordinates in longitudes / latitudes.</span>
<span class="sd">    values : ndarray of float or complex, shape (n,)</span>
<span class="sd">        Data values.</span>
<span class="sd">    xi : 2-D ndarray of floats with shape (m, D), or length D tuple of ndarrays broadcastable to the same shape.</span>
<span class="sd">        Points at which to interpolate data in logitudes / latitudes.</span>
<span class="sd">    method : {&#39;linear&#39;, &#39;nearest&#39;, &#39;cubic&#39;}, optional</span>
<span class="sd">        Method of interpolation. One of</span>

<span class="sd">        ``nearest``</span>
<span class="sd">          return the value at the data point closest to</span>
<span class="sd">          the point of interpolation. See `NearestNDInterpolator` for</span>
<span class="sd">          more details.</span>

<span class="sd">        ``rbf``</span>
<span class="sd">          return the value determined from a radial basis function.</span>
<span class="sd">          See `RBFInterpolator` for more details.</span>

<span class="sd">    kwargs : dict of keyword-arguments</span>
<span class="sd">        Pass optional arguments to interpolation objects specified in &quot;method&quot;.</span>
<span class="sd">        A default value of neighors=12 is automatically applied to rbf.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        Array of interpolated values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;ensure coordinates in xi are the same shape&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate.interpnd</span><span class="w"> </span><span class="kn">import</span> <span class="n">_ndim_coords_from_arrays</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># SciPy 1.15 renamed interpnd to _interpnd (see https://github.com/scipy/scipy/pull/21754).</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate._interpnd</span><span class="w"> </span><span class="kn">import</span> <span class="n">_ndim_coords_from_arrays</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">_ndim_coords_from_arrays</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="n">lons</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># convert to Cartesian coordinates on the unit sphere</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">lonlat2xyz</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">lonlat2xyz</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">input_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">]</span>
    <span class="n">output_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z1</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>

    <span class="n">out_shape</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;rbf&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">RBFInterpolator</span>

        <span class="n">neighbors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">rbf</span> <span class="o">=</span> <span class="n">RBFInterpolator</span><span class="p">(</span><span class="n">input_coords</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rbf</span><span class="p">(</span><span class="n">output_coords</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">out_shape</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;nearest&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">NearestNDInterpolator</span>

        <span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNDInterpolator</span><span class="p">(</span><span class="n">input_coords</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">nn</span><span class="p">(</span><span class="n">output_coords</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">out_shape</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> interpolation is not yet supported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="p">)</span></div>



<span class="c1"># From Simon Williams&#39; GPRM</span>
<div class="viewcode-block" id="find_distance_to_nearest_ridge">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.find_distance_to_nearest_ridge">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_distance_to_nearest_ridge</span><span class="p">(</span>
    <span class="n">resolved_topologies</span><span class="p">,</span> <span class="n">shared_boundary_sections</span><span class="p">,</span> <span class="n">point_features</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">5000.0</span>
<span class="p">):</span>

    <span class="n">all_point_distance_to_ridge</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_point_lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_point_lons</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">topology</span> <span class="ow">in</span> <span class="n">resolved_topologies</span><span class="p">:</span>
        <span class="n">plate_id</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">get_resolved_feature</span><span class="p">()</span><span class="o">.</span><span class="n">get_reconstruction_plate_id</span><span class="p">()</span>

        <span class="c1"># Section to isolate the mid-ocean ridge segments that bound the current plate</span>
        <span class="n">mid_ocean_ridges_on_plate</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">shared_boundary_section</span> <span class="ow">in</span> <span class="n">shared_boundary_sections</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">shared_boundary_section</span><span class="o">.</span><span class="n">get_feature</span><span class="p">()</span><span class="o">.</span><span class="n">get_feature_type</span><span class="p">()</span>
                <span class="o">==</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">create_gpml</span><span class="p">(</span><span class="s2">&quot;MidOceanRidge&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">shared_subsegment</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">shared_boundary_section</span><span class="o">.</span><span class="n">get_shared_sub_segments</span><span class="p">():</span>
                    <span class="n">sharing_resolved_topologies</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">shared_subsegment</span><span class="o">.</span><span class="n">get_sharing_resolved_topologies</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">resolved_polygon</span> <span class="ow">in</span> <span class="n">sharing_resolved_topologies</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">resolved_polygon</span><span class="o">.</span><span class="n">get_feature</span><span class="p">()</span><span class="o">.</span><span class="n">get_reconstruction_plate_id</span><span class="p">()</span>
                            <span class="o">==</span> <span class="n">plate_id</span>
                        <span class="p">):</span>
                            <span class="n">mid_ocean_ridges_on_plate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">shared_subsegment</span><span class="o">.</span><span class="n">get_resolved_geometry</span><span class="p">()</span>
                            <span class="p">)</span>

        <span class="n">point_distance_to_ridge</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">point_lats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">point_lons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">point_feature</span> <span class="ow">in</span> <span class="n">point_features</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">points</span> <span class="ow">in</span> <span class="n">point_feature</span><span class="o">.</span><span class="n">get_geometries</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">topology</span><span class="o">.</span><span class="n">get_resolved_geometry</span><span class="p">()</span><span class="o">.</span><span class="n">is_point_in_polygon</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>

                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mid_ocean_ridges_on_plate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                            <span class="n">min_distance_to_ridge</span> <span class="o">=</span> <span class="kc">None</span>

                            <span class="k">for</span> <span class="n">ridge</span> <span class="ow">in</span> <span class="n">mid_ocean_ridges_on_plate</span><span class="p">:</span>
                                <span class="n">distance_to_ridge</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">GeometryOnSphere</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span>
                                    <span class="n">point</span><span class="p">,</span> <span class="n">ridge</span><span class="p">,</span> <span class="n">min_distance_to_ridge</span>
                                <span class="p">)</span>

                                <span class="k">if</span> <span class="n">distance_to_ridge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">min_distance_to_ridge</span> <span class="o">=</span> <span class="n">distance_to_ridge</span>

                            <span class="n">point_distance_to_ridge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">min_distance_to_ridge</span>
                                <span class="o">*</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">mean_radius_in_kms</span>
                            <span class="p">)</span>
                            <span class="n">point_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">to_lat_lon</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">point_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">to_lat_lon</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

                        <span class="k">else</span><span class="p">:</span>

                            <span class="c1"># Originally, give points in plate IDs without MORs a fill value</span>
                            <span class="n">point_distance_to_ridge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span>
                            <span class="n">point_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">to_lat_lon</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">point_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">to_lat_lon</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

                            <span class="c1"># Try allocating a NoneType to points instead</span>
                            <span class="c1"># point_lats.append(None)</span>
                            <span class="c1"># point_lons.append(None)</span>

                            <span class="c1"># Try skipping the point (this causes the workflow to use nearest neighbour interpolation to fill these regions)</span>
                            <span class="c1"># continue</span>

        <span class="n">all_point_distance_to_ridge</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">point_distance_to_ridge</span><span class="p">)</span>
        <span class="n">all_point_lats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">point_lats</span><span class="p">)</span>
        <span class="n">all_point_lons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">point_lons</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_point_lons</span><span class="p">,</span> <span class="n">all_point_lats</span><span class="p">,</span> <span class="n">all_point_distance_to_ridge</span></div>



<div class="viewcode-block" id="calculate_spreading_rates">
<a class="viewcode-back" href="../../gplately.html#gplately.tools.calculate_spreading_rates">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_spreading_rates</span><span class="p">(</span>
    <span class="n">time</span><span class="p">,</span>
    <span class="n">lons</span><span class="p">,</span>
    <span class="n">lats</span><span class="p">,</span>
    <span class="n">left_plates</span><span class="p">,</span>
    <span class="n">right_plates</span><span class="p">,</span>
    <span class="n">rotation_model</span><span class="p">,</span>
    <span class="n">delta_time</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="n">pygplates</span><span class="o">.</span><span class="n">VelocityUnits</span><span class="o">.</span><span class="n">kms_per_my</span><span class="p">,</span>
    <span class="n">earth_radius</span><span class="o">=</span><span class="n">pygplates</span><span class="o">.</span><span class="n">Earth</span><span class="o">.</span><span class="n">mean_radius_in_kms</span><span class="p">,</span>
<span class="p">):</span>

    <span class="n">VELOCITY_UNITS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">pygplates</span><span class="o">.</span><span class="n">VelocityUnits</span><span class="o">.</span><span class="n">kms_per_my</span><span class="p">,</span>
        <span class="n">pygplates</span><span class="o">.</span><span class="n">VelocityUnits</span><span class="o">.</span><span class="n">cms_per_yr</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">SPREADING_FEATURES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;gpml:MidOceanRidge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gpml:ContinentalRift&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VELOCITY_UNITS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid `units` argument: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">))</span>

    <span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="c1"># delta_time = float(time)</span>
    <span class="n">delta_time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">delta_time</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">left_plates</span><span class="p">,</span> <span class="n">right_plates</span><span class="p">)))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Length mismatch: len(lons) = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;, len(lats) = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;, len(left_plates) = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_plates</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;, len(right_plates) = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">right_plates</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="n">plate_pairs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">pair</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;lons&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;lats&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="n">_get_rotation</span><span class="p">(</span>
                <span class="n">pair</span><span class="p">,</span>
                <span class="n">rotation_model</span><span class="p">,</span>
                <span class="n">time</span><span class="p">,</span>
                <span class="n">delta_time</span><span class="p">,</span>
                <span class="n">use_identity_for_missing_plate_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;indices&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">left_plates</span><span class="p">,</span> <span class="n">right_plates</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">left_plate</span><span class="p">,</span> <span class="n">right_plate</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="n">lons</span><span class="p">,</span>
            <span class="n">lats</span><span class="p">,</span>
            <span class="n">left_plates</span><span class="p">,</span>
            <span class="n">right_plates</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">):</span>
        <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">left_plate</span><span class="p">,</span> <span class="n">right_plate</span><span class="p">)</span>
        <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;lons&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;lats&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">plate_pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;rotation&quot;</span><span class="p">]</span>
        <span class="n">pair_lons</span> <span class="o">=</span> <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;lons&quot;</span><span class="p">]</span>
        <span class="n">pair_lats</span> <span class="o">=</span> <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;lats&quot;</span><span class="p">]</span>
        <span class="n">pair_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pair_lats</span><span class="p">,</span> <span class="n">pair_lons</span><span class="p">))</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">plate_pairs</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">calculate_velocities</span><span class="p">(</span>
                <span class="n">domain_points</span><span class="o">=</span><span class="n">pair_points</span><span class="p">,</span>
                <span class="n">finite_rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span>
                <span class="n">time_interval_in_my</span><span class="o">=</span><span class="n">delta_time</span><span class="p">,</span>
                <span class="n">velocity_units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
                <span class="n">earth_radius_in_kms</span><span class="o">=</span><span class="n">earth_radius</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="n">pygplates</span><span class="o">.</span><span class="n">LocalCartesian</span><span class="o">.</span><span class="n">convert_from_geocentric_to_magnitude_azimuth_inclination</span><span class="p">(</span>
                <span class="n">local_origins</span><span class="o">=</span><span class="n">pair_points</span><span class="p">,</span>
                <span class="n">vectors</span><span class="o">=</span><span class="n">velocities</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">velocities</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">velocity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">velocities</span><span class="p">):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity</span>

    <span class="c1"># print(out)</span>
    <span class="c1"># print(sorted(out))</span>
    <span class="c1"># print(&quot;\n&quot;)</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="p">],</span> <span class="n">indices</span>  <span class="c1"># [indices[i] for i in sorted(indices)]</span></div>



<div class="viewcode-block" id="_get_rotation">
<a class="viewcode-back" href="../../gplately.html#gplately.tools._get_rotation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_get_rotation</span><span class="p">(</span><span class="n">plate_pair</span><span class="p">,</span> <span class="n">rotation_model</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">delta_time</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">to_time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">delta_time</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="n">from_time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="n">delta_time</span> <span class="o">*</span> <span class="mf">0.5</span>

    <span class="k">if</span> <span class="n">to_time</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">to_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">from_time</span> <span class="o">=</span> <span class="n">delta_time</span>

    <span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation_model</span><span class="o">.</span><span class="n">get_rotation</span><span class="p">(</span>
        <span class="n">to_time</span><span class="o">=</span><span class="n">to_time</span><span class="p">,</span>
        <span class="n">from_time</span><span class="o">=</span><span class="n">from_time</span><span class="p">,</span>
        <span class="n">moving_plate_id</span><span class="o">=</span><span class="n">plate_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">anchor_plate_id</span><span class="o">=</span><span class="n">plate_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rotation</span></div>



<div class="viewcode-block" id="_deg2pixels">
<a class="viewcode-back" href="../../gplately.html#gplately.tools._deg2pixels">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_deg2pixels</span><span class="p">(</span><span class="n">deg_res</span><span class="p">,</span> <span class="n">deg_min</span><span class="p">,</span> <span class="n">deg_max</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">deg_max</span> <span class="o">-</span> <span class="n">deg_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">deg_res</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="_pixels2deg">
<a class="viewcode-back" href="../../gplately.html#gplately.tools._pixels2deg">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">_pixels2deg</span><span class="p">(</span><span class="n">spacing_pixel</span><span class="p">,</span> <span class="n">deg_min</span><span class="p">,</span> <span class="n">deg_max</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">deg_max</span> <span class="o">-</span> <span class="n">deg_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">spacing_pixel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2025, The University of Sydney.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>